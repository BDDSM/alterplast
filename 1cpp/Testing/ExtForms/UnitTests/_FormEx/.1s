Перем Журнал Экспорт;
Перем фКоличествоНажатийКлавиатуры;

//#if _NOW_PREPARE_CLASS
Перем База;

//#else 
//#endif

//#if _NOW_PREPARE_CLASS

Функция Конт(Конт) Возврат Конт; КонецФункции // : Контекст
Функция Сам() Возврат Конт(Контекст); КонецФункции // : Контекст

Процедура Деструктор()
	Журнал.ДобавитьЗапись("КОП::Деструктор");
КонецПроцедуры	// Деструктор

Процедура Инициализация(конт, Журнал1) Экспорт
	База = Конт;

	Журнал = Журнал1;
	Журнал.ДобавитьЗапись("КОП::Инициализация");

	фКоличествоНажатийКлавиатуры = 0;

КонецПроцедуры
            
Процедура ПослеОткрытия() // !! Специально без Экспорт - это событие не должно сработать !!
	Журнал.ДобавитьЗапись("КОП::ПослеОткрытия");
КонецПроцедуры

Процедура Событие_ПослеОткрытия() Экспорт // а вот это должно !!
	Журнал.ДобавитьЗапись("КОП::Событие_ПослеОткрытия");

	Перехватчик = СоздатьОбъект("Перехватчик");
	Перехватчик.ВыполнитьОригинальноеСобытиеГК(База, "ПослеОткрытия");
КонецПроцедуры  
            
Процедура ПослеСозданияФормы() // !! Специально без Экспорт - это событие не должно сработать !!
	Журнал.ДобавитьЗапись("КОП::ПослеСозданияФормы");
КонецПроцедуры

Процедура Событие_ПослеСозданияФормы() Экспорт // а вот это должно !!
	Журнал.ДобавитьЗапись("КОП::Событие_ПослеСозданияФормы");

	Перехватчик = СоздатьОбъект("Перехватчик");
	Перехватчик.ВыполнитьОригинальноеСобытиеГК(База, "ПослеСозданияФормы");
КонецПроцедуры  

Процедура Событие_ПриНажатииКнопкиКлавиатуры(КодКлавиши, Alt, Shift, Ctrl, Символ, ФСО) Экспорт
	фКоличествоНажатийКлавиатуры = фКоличествоНажатийКлавиатуры + 1;
	
	Если фКоличествоНажатийКлавиатуры = 1 Тогда
		Журнал.ДобавитьЗапись("КОП::ПриНажатииКнопкиКлавиатуры<"+КодКлавиши+">");
	КонецЕсли;
КонецПроцедуры

//#else 
// работа с формой

Процедура ПриОткрытии()
	Журнал=СоздатьОбъект("ЖурналВызоваМетодов");
	Журнал.ДобавитьЗапись("Форма::ПриОткрытии");

	фКоличествоНажатийКлавиатуры = 0;

	//Форма.Параметр = Журнал;
	КлассПерехватчикГК = СоздатьОбъект("КлассПерехватчикГК_СобытияFormEx");
	КлассПерехватчикГК.Инициализация(Контекст, Журнал);
	
	Перехватчик = СоздатьОбъект("Перехватчик");
	Перехватчик.ПерехватитьСобытияГК(Контекст, КлассПерехватчикГК);
	
	Форма.Параметр = КлассПерехватчикГК;
	
КонецПроцедуры
      
Процедура ПослеОткрытия()
	Журнал.ДобавитьЗапись("Форма::ПослеОткрытия");
КонецПроцедуры

//Процедура ПриНажатииКнопкиКлавиатуры(КонтФормы, КодКлавиши, Alt, Shift, Ctrl, Символ, ФСО)
Процедура ПриНажатииКнопкиКлавиатуры(КодКлавиши, Alt, Shift, Ctrl, Символ, ФСО)
	фКоличествоНажатийКлавиатуры = фКоличествоНажатийКлавиатуры + 1;
	
	Если фКоличествоНажатийКлавиатуры = 1 Тогда
		Журнал.ДобавитьЗапись("Форма::ПриНажатииКнопкиКлавиатуры<"+КодКлавиши+">");
	КонецЕсли;
КонецПроцедуры

//*******************************************
Процедура Сформировать()

КонецПроцедуры

//#endif