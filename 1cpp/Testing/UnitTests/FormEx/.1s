Функция Конт(Конт) Возврат Конт; КонецФункции // : Контекст
Функция Сам() Возврат Конт(Контекст); КонецФункции

Функция МетаИнфо() Возврат СоздатьОбъект("MetaInfoClasses"); КонецФункции // : MetaInfoClasses

Процедура ПроверитьПодключениеТаблицы(Таблица, ТестовыйОбъект) Экспорт
	ЗаголовокОкна="Тестовый заголовок";
	Таблица.ВывестиСекцию("Описатель");
	ТестовыйОбъект.ПроверитьРавенство(Таблица.Область(1, 2).Текст, "Тестовый заголовок");
КонецПроцедуры
//--------------------------------------------

Процедура ПроверитьПодключениеВторойТаблицы(Таблица, ТестовыйОбъект)
	ТестовоеВыражение=55;
	Таблица.Вывести();
	ТестовыйОбъект.ПроверитьРавенство(Таблица.Область(1, 1).Текст, "55");
КонецПроцедуры
//--------------------------------------------

Функция ПолучитьТаблицуСШаблоном(ИмяТаблицы, Расположение) Экспорт
	таб=СоздатьОбъект("Таблица");
	таб.ИсходнаяТаблица(ИмяТаблицы, Расположение);
	Возврат таб;
КонецФункции
//--------------------------------------------

Процедура Тест_ТаблицаВоВнешнемФайлеMXL() Экспорт
	Сам=Сам();
	Путь=КаталогИБ()+"UnitTests\FormEx\ТестИсходнойТаблицы.mxl";
	Таблица=СоздатьОбъект("Таблица");
	//Сам.ЭмулироватьПадение1С(); Таблица.ИсходнаяТаблица(Путь);
	Таблица.ИсходнаяТаблица(Путь);
	ПроверитьПодключениеТаблицы(Таблица, Сам);

	таб=Сам.ПолучитьТаблицуСШаблоном(Путь, );
	ПроверитьПодключениеТаблицы(Таблица, Сам);

	таб=Сам.ПолучитьТаблицуСШаблоном(, Путь);
	ПроверитьПодключениеТаблицы(Таблица, Сам);
КонецПроцедуры
//--------------------------------------------

Процедура Тест_ТаблицаНеНайдена() Экспорт
	Сам=Сам();
	Сам().ПроверитьИсключение(Сам, "ПолучитьТаблицуСШаблоном", "НетТакойТаблицы", "MD.Документ.Новый1.Форма");
КонецПроцедуры
//--------------------------------------------

Процедура Тест_ТаблицаНеНайдена2() Экспорт
	Сам=Сам();
	Сам().ПроверитьИсключение(Сам, "ПолучитьТаблицуСШаблоном", "Таблица", "MD.Документ.НетТакого.Форма");
КонецПроцедуры
//--------------------------------------------

Процедура Тест_ТаблицаВКонфигурации() Экспорт
	Сам=Сам();
	таб=СоздатьОбъект("Таблица");
	таб.ИсходнаяТаблица("Таблица", "MD.Обработка.ТрассировкаФорма.Форма");
	ПроверитьПодключениеТаблицы(таб, Сам);
КонецПроцедуры
//--------------------------------------------

Процедура Тест_ТаблицаВоВнешнемФайлеОбработки() Экспорт
	Сам=Сам();
	Путь = КаталогИБ()+"ExtForms\UnitTests\ТестыИсходнойТаблицы.ert";
	
	таб=СоздатьОбъект("Таблица");     
	таб.ИсходнаяТаблица("Таблица", Путь);
	ПроверитьПодключениеТаблицы(таб, Сам);
КонецПроцедуры
//--------------------------------------------

Функция ПолучитьТаблицуОбъекта(Объект, ИдТаблицы) Экспорт
	Возврат ПолучитьТаблицуСШаблоном(ИдТаблицы, Объект.ПолучитьПуть());
КонецФункции
//--------------------------------------------

Процедура Тест_ТаблицаВФайлеКласса() Экспорт
	Сам=Сам();
	таб=ПолучитьТаблицуОбъекта(Сам, "Таблица");
	ПроверитьПодключениеТаблицы(таб, Сам);

	таб=ПолучитьТаблицуОбъекта(Сам, "ВтораяТаблица");
	ПроверитьПодключениеВторойТаблицы(таб, Сам);
	
	таб=ПолучитьТаблицуОбъекта(Сам, "");
	ПроверитьПодключениеТаблицы(таб, Сам);
	
	таб=ПолучитьТаблицуОбъекта(Сам,);
	Сам.ПроверитьПодключениеТаблицы(таб, Сам);
КонецПроцедуры
//--------------------------------------------

Процедура Тест_ТаблицаВФайлеКлассаИзКонфигурации() Экспорт
	Сам=Сам();
	Объект = СоздатьОбъект("КлассСТаблицейВКонфигурации");
	
	таб=ПолучитьТаблицуОбъекта(Объект, "Таблица");
	ПроверитьПодключениеТаблицы(таб, Сам);
КонецПроцедуры
//--------------------------------------------

Процедура Тест_ТаблицыВоВнешнейобработке() Экспорт
	Сам=Сам();
	спПараметры=СоздатьОбъект("СписокЗначений");
	спПараметры.Установить("ОбъектТеста", Сам);
	Конт=спПараметры;
	ОткрытьФорму("Отчет", Конт, Сам.ПолучитьПуть());
	Сам.ПроверитьРавенство(спПараметры.Получить("Результат"), "Да");
КонецПроцедуры
//--------------------------------------------

//#if !_NOW_PREPARE_CLASS
Процедура ПриОткрытии()
Перем Путь, ИмяФайлаОбработки;

	СтатусВозврата(0);
	Параметры=Форма.Параметр;
	Тест=Параметры.Получить("ОбъектТеста");
	Параметры.Установить("Результат", "Нет");
	
	РасположениеФайла(Путь, ИмяФайлаОбработки);
	ИмяФайлаОбработки=Путь+ИмяФайлаОбработки;
	
	таб=ПолучитьТаблицуСШаблоном("Таблица", ИмяФайлаОбработки);
	ПроверитьПодключениеТаблицы(таб, Тест);

	таб=СоздатьОбъект("Таблица");
	таб.ИсходнаяТаблица("Таблица");
	ПроверитьПодключениеТаблицы(таб, Тест);
	
	таб=ПолучитьТаблицуСШаблоном("ВтораяТаблица",);
	ПроверитьПодключениеВторойТаблицы(таб, Тест);
	
	таб=ПолучитьТаблицуСШаблоном("",);
	ПроверитьПодключениеТаблицы(таб, Тест);

	таб=ПолучитьТаблицуСШаблоном("Таблица", "");
	ПроверитьПодключениеТаблицы(таб, Тест);
	
	Параметры.Установить("Результат", "Да");
КонецПроцедуры
//--------------------------------------------
//#endif