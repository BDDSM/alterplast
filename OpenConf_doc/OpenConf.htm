<html><head>
<meta http-equiv="Content-Language" content="ru">
<meta http-equiv="Content-Type" content="text/html; charset=windows-1251">
<meta http-equiv="Content-Script-Type" content="text/javascript">
<title>OpenConf</title>
<meta name="keywords" content="OpenConf 1С:Предприятие">
<meta name="description" content="Проект OpenConf (Открытый Конфигуратор)">
<style type="text/css"> 
	.paragraph {text-align:justify; text-indent:2em; margin-top:0; margin-bottom:0}
</style>
</head>
<body bgcolor=#E0E0E0>

<p><a href="index.html">Перейти на главную страничку сайта (список статей, файлы для скачивания)</a></p>
<p><a href="http://forum.script-coding.com">ФОРУМ (здесь можно обсудить эту статью, а также любые
проблемы программирования на различных макроязыках и в скриптовых средах)</a></p>

<h1>Проект OpenConf (Открытый Конфигуратор)</h1>

<h2 style="text-indent:1.3em">Понятие об OpenConf</h2>

<p class="paragraph">
Как известно, "1С-Предприятие 7.7" - продукт хороший и распространённый. И основной его козырь - открытость
платформы. Там, где штатных функций программы не хватает, всегда есть лазейка в виде "Внешних Компонент".
Однако, все эти возможности затрагивают только пользовательскую часть программы. В Конфигураторе штатных методов
для загрузки дополнительных модулей нет. Может, на момент выхода Конфигуратор и удовлетворял программистов по своим
возможностям, но на сегодняшний день их уже явно недостаточно. С целью преодолеть все эти ограничения и был задуман
этот проект.
</p>

<p class="paragraph">
К числу возможностей OpenConf ("Открытого Конфигуратора") относятся:
</p>

<UL style="text-indent:0em; margin-top:5; margin-bottom:5;">
<LI>Oбъектная модель Конфигуратора, которая позволяет обращаться к объектам Конфигуратора из скриптов и плагинов.</LI>
<LI>OpenConf внедряет в среду Конфигуратора технологию "ActiveScripting", позволяющую исполнять скрипты на любом из
установленных в системе ActiveScript-языков. Наиболее распространенные из них - это VBScript и JScript,
установленные практически на любом компьютере с Windows.</LI>
<LI>Архитектура плагинов (плагины представляют из себя dll-библиотеки, т.е. дополнительные программные модули,
подключаемые к OpenConf), которая позволяет с легкостью писать плагины для Конфигуратора на любом из языков,
способных работать с IDispatch и OLE Automation.</LI>
</UL>

<p class="paragraph">
Каким образом и для каких целей можно использовать вышеперечисленные возможности OpenConf? Например, в настоящее
время сообществом OpenConf уже разработан ряд скриптов и плагинов со следующими возможностями:
</p>

<UL style="text-indent:0em; margin-top:5; margin-bottom:5;">
<LI>Intellisense в среде 1С:Предприятие v7.7. (при вводе текста модуля программа предлагает интеллектуальное
автодополнение и информацию о синтаксисе текущего оператора, как в "серьёзных" средах разработки).</LI>
<LI>Автоматическая загрузка измененной конфигурации на основе параметра в командной строке, автозагрузка ert-файлов
в Конфигуратор через командную строку запуска Конфигуратора.</LI>
<LI>Автоматизация процесса объединения изменений конфигурации при совместной работе, набор скриптов и макросов для
работы с gcomp & cvs.</LI>
<LI>Скрипты для ускорения составления различных синтаксических конструкций на встроенном языке 1С:Предприятие v7.7
(например, запрос к бухитогам, выборка документов, запись проводок, конструктор предопределённых процедур, выборка
и поиск по справочникам, конструкции для работы с таблицами значений - поиск, заполнение).</LI>
<LI>Поиск текста в текущем модуле с установкой закладок.</LI>
<LI>Быстрое перемещение по тексту модуля (по синтаксическим конструкциям) различными способами.</LI>
<LI>Быстрый доступ к объектам метаданных конфигурации или объектам файловой системы, задаваемым в тексте модуля,
открытие файла из директивы ЗагрузитьИзФайла, быстрый переход к процедуре/функции, заданной в поле "Формула"
элемента управления.</LI>
<LI>Назначение клавиатурных сочетаний на команды Конфигуратора.</LI>
<LI>Конструкторы элементов диалога при работе с редактором форм.</LI>
<LI>Удаление пробелов в концах строк и лишних пустых строк программных модулей, автоматическая вставка комментариев
при замене участка кода, выравнивание выделенного текста по знакам "=".</LI>
<LI>Библиотека функций, часто используемых в скриптах для OpenConf.</LI>
</UL>

<p class="paragraph">
Состав скриптов и плагинов и их функционал постоянно расширяется сообществом OpenConf. Кроме того, вы можете
самостоятельно разрабатывать скрипты с нужным вам функционалом без использования каких-либо сложных средств
разработки, работая в любом текстовом редакторе.
</p>

<h2 style="text-indent:1.3em">Об авторах и порядке распространения OpenConf</h2>

<p class="paragraph">
Автор программы - Александр Орефков, адрес электронной почты которого вы можете найти в диалоге "О программе"
OpenConf. OpenConf бесплатен, хотя плагины к нему могут быть платными. В общем случае никаких ограничений на
распространение OpenConf/плагинов/скриптов не наложено. Разработка и распространение плагинов и скриптов OpenConf
производится неофициальным сообществом OpenConf:
</p>

<UL style="text-indent:0em; margin-top:5; margin-bottom:5;">
<LI>
Сайт, посвящённый OpenConf:<br>
<a href="http://openconf.1cpp.ru/">http://openconf.1cpp.ru/</a>
</LI>
<LI>
Инсталлятор OpenConf, плагины и скрипты к нему размещены в клубе профессионалов 1С:<br>
<a href="http://1c.proclub.ru/modules/mydownloads/viewcat.php?cid=1002">http://1c.proclub.ru/modules/mydownloads/viewcat.php?cid=1002</a>
</LI>
<LI>
Небольшие FAQ'и по OpenConf и архив веток с обсуждениями OpenConf на форуме "Территория 1С":<br>
<a href="http://1c.alterplast.ru/faq/telepat.html">http://1c.alterplast.ru/faq/telepat.html</a><br>
<a href="http://1c.alterplast.ru/faq/openconf.html">http://1c.alterplast.ru/faq/openconf.html</a><br>
Архивы сборок скриптов для OpenConf по датам:<br>
<a href="http://1c.alterplast.ru/files/ocs/">http://1c.alterplast.ru/files/ocs/</a><br>
Последняя сборка скриптов для OpenConf обычно всегда лежит здесь:<br>
<a href="http://1c.alterplast.ru/files/ocs/ocs_last.dos.zip">http://1c.alterplast.ru/files/ocs/ocs_last.dos.zip</a><br>
Блог изменений сборки скриптов для OpenConf можно увидеть здесь (обновляется ежедневно автоматически):<br>
<a href="http://1c.alterplast.ru/files/ocs/changelog.html">http://1c.alterplast.ru/files/ocs/changelog.html</a>
</LI>
<LI>
Сборку инсталлятора для OpenConf, укомплектованную плагинами и скриптами можно взять здесь:<br>
<a href="http://kuntashov.narod.ru/openconf-installer.html">http://kuntashov.narod.ru/openconf-installer.html</a>
</LI>
<LI>
На itland.ru есть специальный форум для обсуждения именно OpenConf и его плагинов:<br>
<a href="http://itland.ru/forum/index.php?showforum=37">http://itland.ru/forum/index.php?showforum=37</a>
</LI>
<LI>
Специальный форум для обсуждения OpenConf и его плагинов:<br>
<a href="http://www.1cpp.ru/forum/YaBB.pl?board=openconf">http://www.1cpp.ru/forum/YaBB.pl?board=openconf</a>
</LI>
<LI>
Блог, посвящённый OpenConf:<br>
<a href="http://npj.ru/kuntashov/openconf">http://npj.ru/kuntashov/openconf</a>
</LI>
<LI>
Работа с OpenConf обсуждается на форумах по 1С:<br>
<a href="http://www.kuban.ru/cgi-bin/forum/forum9.cgi">http://www.kuban.ru/cgi-bin/forum/forum9.cgi</a>
<br>
<a href="http://www.forum.mista.ru">http://www.forum.mista.ru</a>
</LI>
</UL>

<p class="paragraph">
Кроме того, вы можете скачать дистрибутивы OpenConf прямо с этой странички (размер файлов указан в байтах):
</p>

<br>
<TABLE border="1" width="100%" cellspacing="0">
<TR><TH>Дистрибутив</TH><TH>Описание</TH></TR>

<TR>
<TD nowrap><a href="ocb1020.zip">OpenConf 1.0.2.0 (beta)</a> - 157 201.</TD>
<TD>Собственно OpenConf.</TD>
</TR>

<TR>
<TD nowrap><a href="telepatr.zip">Telepat v2.0.0.0r (beta)</a> - 175 792.</TD>
<TD>Плагин Телепат, реализующий Intellisense в среде 1С:Предприятие v7.7. Предполагается, что финальная версия
Телепата будет платной (около 500 рублей).</TD>
</TR>

<TR>
<TD nowrap><a href="telepats.zip">Telepat v2.0.0.0s (beta)</a> - 173 604.</TD>
<TD>Более новая версия Телепата (от 30.04.2007) с небольшими улучшениями.</TD>
</TR>

<TR>
<TD nowrap><a href="telepatt.rar">Telepat v2.0.0.0t (beta)</a> - 155 466.</TD>
<TD>Более новая версия Телепата (от 17.09.2007) с небольшими доработками специально для взаимодействия с плагином <a href="OColorer.html">OColorer</a>.</TD>
</TR>

<TR>
<TD nowrap><a href="ocs_last.dos.zip">Скрипты (21-Октябрь-2008)</a> - 1 212 832.</TD>
<TD>Большой набор скриптов и дополнительных компонент для OpenConf с описаниями.</TD>
</TR>

<TR>
<TD nowrap><a href="Bookmarks.zip">Скрипт Bookmarks.vbs</a> - 3 662.</TD>
<TD>Скрипт для работы с закладками в модулях Конфигуратора.</TD>
</TR>

</TABLE>
<br>

<p class="paragraph">
Примечание: некоторые файлы скриптов в сборке скриптов могут определяться шибко умными антивирусами как подозрительные или даже заражённые; вы всегда можете просмотреть и проанализировать код каждого такого файла в любом текстовом редакторе, чтобы убедиться, что это не соответствует действительности. Кроме того, информацию о проверке сборки скриптов различными антивирусами вы можете получить на <a href="http://forum.script-coding.com/viewtopic.php?id=50">форуме этого сайта</a>, а также в <a href="http://npj.ru/kuntashov/open_conf/virii">этом блоге</a>.
</p>

<h2 style="text-indent:1.3em">Установка OpenConf</h2>

<p class="paragraph">
Установка OpenConf предельно проста:
</p>

<OL style="text-indent:0em; margin-top:5; margin-bottom:5;">
<LI>В каталоге "bin" исполняемых файлов 1С:Предприятия создайте каталог "config".</LI>
<LI>Файл "config.dll", находящийся в каталоге "bin", переместите в каталог "config".</LI>
<LI>На место перемещённого оригинального файла "config.dll" в каталоге "bin" поместите файл "config.dll" из поставки
OpenConf.</LI>
<LI>Файл "config.tlb" из поставки OpenConf поместите в каталог "bin".</LI>
</OL>

<p class="paragraph">
После установки запустите Конфигуратор и откройте окно конфигурации (меню "Конфигурация" - "Открыть конфигурацию").
Если кроме закладок "Метаданные", "Интерфейсы" и "Права" вы видите закладку "OpenConf", установка прошла успешно.
</p>

<p class="paragraph">
Если у вас упала 1С, нет четвёртой закладки, есть закладка, но ничего не работает или просто день не задался (хотя
совершенно непонятно, отчего это могло произойти), удалите папку "config", снесите 1С, после чего установите 1C и
OpenConf еще раз.
</p>

<h2 style="text-indent:1.3em">Принципы работы OpenConf</h2>

<p class="paragraph">
OpenConf загружается только в режиме "Конфигуратора" и не оказывает влияния на работу 1С в режиме "Предприятия".
</p>

<p class="paragraph">
В основу механизма OpenConf положен способ подмены библиотеки config.dll, используемой 1С:Предприятием для работы
Конфигуратора. Вместо "родной" config.dll загружается подменная, которая, оказываясь в адресном пространстве
процесса, получает возможность выполнять дополнительные действия в программе и в свою очередь загружает "родную"
config.dll для обеспечения штатной работы.
</p>

<p class="paragraph">
Основополагающий принцип работы основан на том факте, что большая часть функционала 1С-Предприятия размещена в
библиотеках dll, экспортирующих свои функции по именам. Это позволяет воссоздать заголовочные файлы и библиотеки
импорта для этих dll и в дальнейшем обращаться к ним также, как это делается самой программой 1С. Немаловажно и то,
что сама 1С-Предприятие написана с использованием библиотеки MFC, исходные коды которой открыты. Это позволяет во
многих случаях понять принципы работы программы и уточнить заголовки классов, полученных из экспортируемых функций
dll 1С:Предприятия. В своих методах OpenConf по большей части пользуется "штатными" функциями 1С, доступными через
ее dll. OpenConf не работает напрямую с файлом метаданных, не парсит Main MetaDataStream, не считает CRC и т.п. Для
выполнения своих действий он просто обращается к "внутренним" функциям 1С. По сути дела, объектная модель OpenConf
просто OLE-обертка вокруг C++ объектов 1С.
</p>

<p class="paragraph">
Итак, при запуске Конфигуратора вместо оригинальной config.dll загружается подменная. Она в свою очередь производит
следующие действия:
</p>

<UL style="text-indent:0em; margin-top:5; margin-bottom:5;">
<LI>Загружает оригинальную config.dll из каталога config.</LI>
<LI>Загружает все плагины из каталога config (все dll, которые там расположены).</LI>
<LI>Запускает все скрипты, размещенные в каталоге config\scripts.</LI>
</UL>

<h2 style="text-indent:1.3em">Использование OpenConf</h2>

<h3 style="text-indent:1.7em">Вкладка OpenConf окна Конфигурации</h3>

<p class="paragraph">
При правильной установке в окне Конфигурации появляется вкладка OpenConf. Вкладка состоит из двух панелей: в левой
части отображается дерево загруженных скриптов и плагинов, в правой - дополнительная информация о выбранном элементе
дерева. Дерево состоит из двух ветвей: "Скрипты" и "Плагины".
</p>

<p class="paragraph">
В разделе "Плагины" вкладки "OpenConf" в окне Конфигурации отображаются все загруженные плагины. Состав подэлементов
плагина и выводящейся в правой панели информации о нём зависят от типа плагина и его возможностей. Для плагинов, не
имеющих визуального интерфейса, а также для визуальных плагинов, открываемых в отдельной странице, в правой части
отображается информация о версии dll-файла плагина. Иначе в правой части отображается визуальный интерфейс плагина.
Для плагинов, не запретивших отображение макросов, выводится их список. Макросы - это процедуры и функции плагинов,
не имеющие параметров. Контекстное меню ветви "Плагины" позволяет загрузить новый плагин (при запуске Конфигуратора
все плагины из каталога config загружаются автоматически).
</p>

<p class="paragraph">
В разделе "Скрипты" вкладки "OpenConf" в окне Конфигурации каждый скрипт представлен одним элементом раздела. Для
каждого скрипта в виде подэлементов дерева также выводятся все его "макросы", которые можно запустить двойным
щелчком мыши, либо нажатием ENTER. Макросы - это процедуры и функции скриптов, не имеющие параметров. Двойной щелчок
мыши, либо нажатие ENTER на самом элементе скрипта открывает скрипт для редактирования в текстовом редакторе
1С:Предприятия. Путь к файлу загруженного скрипта можно увидеть в правой панели вкладки OpenConf. Контекстное меню
ветви "Скрипты" позволяет:
</p>

<UL style="text-indent:0em; margin-top:5; margin-bottom:5;">
<LI>Загрузить новый скрипт. При этом открывается диалог выбора файла. В момент выбора файла скрипта он немедленно
запускается. При запуске Конфигуратора все скрипты, размещенные в каталоге config\scripts, загружаются и запускаются
автоматически.</LI>
<LI>Вызвать справку. При этом запускается файл "openconf.chm", который должен находиться в каталоге "bin"
1С:Предприятия.</LI>
<LI>Вызвать диалог "О программе".</LI>
</UL>

<p class="paragraph">
Контекстное меню элемента дерева, соответствующее конкретному загруженному скрипту, позволяет:
</p>

<UL style="text-indent:0em; margin-top:5; margin-bottom:5;">
<LI>Открыть скрипт для редактирования в текстовом редакторе 1С:Предприятия. После изменения скрипта его необходимо
перезагрузить.</LI>
<LI>Перезагрузить скрипт, если он был изменён. При запуске Конфигуратора все скрипты, размещенные в каталоге
config\scripts, перезагружаются и запускаются автоматически.</LI>
<LI>Выгрузить скрипт.</LI>
</UL>

<h3 style="text-indent:1.7em">Колонка "OpenConf" главного меню Конфигуратора</h3>

<p class="paragraph">
При правильной установке помимо вкладки "OpenConf" в окне Конфигурации в главном меню Конфигуратора появляется
колонка "OpenConf":
</p>

<UL style="text-indent:0em; margin-top:5; margin-bottom:5;">
<LI>Меню "OpenConf" - "Макросы" - "Выполнить..." открывает окно "Макросы", из которого можно запустить на выполнение
любой макрос любого загруженного скрипта. Клавиатурный эквивалент вызова этого окна - Ctrl+M.</LI>
<LI>Меню "OpenConf" - "Макросы" - "Настройка команд..." открывает окно "Пользовательские команды". Здесь можно
пополнить список команд подменю "OpenConf" - "Макросы" собственными пунктами, вызывающими заданные макросы любого
загруженного скрипта.
</LI>
<LI>Меню "OpenConf" - "Макросы" - "Клавиатура..." открывает окно "Настройка клавиатуры". Здесь можно задать
клавиатурные команды, вызывающие заданные макросы любого загруженного скрипта.</LI>
<LI>Меню "OpenConf" - "Формы" недоступно и возможно будет реализовано в следующих версиях OpenConf.</LI>
<LI>Меню "OpenConf" - "Загрузить скрипт..." выполняет то же действие, что и команда "Загрузить скрипт..."
контекстного меню ветви "Скрипты" на вкладке "OpenConf" в окне Конфигурации, описанная выше.</LI>
<LI>Меню "OpenConf" - "Загрузить плагин..." выполняет то же действие, что и команда "Загрузить плагин..."
контекстного меню ветви "Плагины" на вкладке "OpenConf" в окне Конфигурации, описанная выше.</LI>
<LI>Меню "OpenConf" - "Настройка панелей..." открывает окно "Настройка панелей". Здесь можно добавить/удалить
панели инструментов Конфигуратора, используя функционал загруженных плагинов.</LI>
<LI>Меню "OpenConf" - "Справка" запускает файл "openconf.chm", который должен находиться в каталоге "bin"
1С:Предприятия.</LI>
<LI>Меню "OpenConf" - "О программе..." вызывает диалог "О программе".</LI>
</UL>

<p class="paragraph">
Кроме того, в результате установки OpenConf в Конфигураторе появляется дополнительная панель инструментов "OpenConf",
которую можно вывести на экран обычными способами, например через меню "Сервис" - "Панели инструментов...". Эта
панель инструментов дублирует некоторые команды меню "OpenConf".
</p>

<h3 style="text-indent:1.7em">Тест загрузки и использования скрипта</h3>

<p class="paragraph">
Создайте текстовый файл с расширением vbs следующего содержания:
</p>

<br>
<span style="color:navy; font-weight:bold;">
<pre>
MsgBox "Hello, OpenConf!"
Sub MyMacro()
	MsgBox "Hello, my macro!"
End Sub
</pre>
</span>

<p class="paragraph">
Выполните следующие действия:
</p>

<OL style="text-indent:0em; margin-top:5; margin-bottom:5;">
<LI>Поместите созданный vbs-файл в подкаталог "config\scripts\" каталога "bin" 1С:Предприятия.</LI>
<LI>Перезапустите Конфигуратор. Вы должны увидеть диалоговое окно с текстом "Hello, OpenConf!".</LI>
<LI>Зайдите в меню "OpenConf" - "Макросы" - "Клавиатура..." и задайте комбинацию клавиш для вызова макроса
"MyMacro" тестового скрипта.</LI>
<LI>Нажмите заданную комбинацию клавиш. Вы должны увидеть диалоговое окно с текстом "Hello, my macro!".</LI>
<LI>Зайдите на вкладку OpenConf окна конфигурации и выгрузите тестовый скрипт с помощью соответствующей команды
контекстного меню. Выгрузить скрипт также можно, просто переместив его из папки "config\scripts\" каталога "bin"
1С:Предприятия (при следующем запуске Конфигуратора он уже не загрузится). Если скрипт загружался не из папки
"config\scripts\" каталога "bin" 1С:Предприятия, а из произвольного каталога на жёстком диске, его можно
выгрузить, просто переименовав (при следующем запуске Конфигуратора он также уже не загрузится).</LI>
</OL>

<h2 style="text-indent:1.3em">Разрешение проблем</h2>

<p class="paragraph">
Если после выхода из Конфигуратора его процесс "застревает" в памяти, необходимо переустановить Windows Script Host,
скачав с сайта Microsoft последнюю версию Windows Script Host (сейчас это версия 5.6). Нужно именно переустанавливать
WSH, даже в том случае, если у вас уже стоит версия 5.6.
</p>

<p style="text-align:right">
<small>Людоговский Александр</small>
</p>

<p><a href="index.html">Перейти на главную страничку сайта (список статей, файлы для скачивания)</a></p>

<p><small>&copy; 2007 <A HREF='http://www.script-coding.com/'>http://www.script-coding.com</A> При любом использовании материалов сайта обязательна <b>ссылка</b> на него как на источник информации, а также сохранение <b>целостности</b> и <b>авторства</b> материалов.</small>



</body></html>