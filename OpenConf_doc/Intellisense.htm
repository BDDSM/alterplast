<html><head>
<meta http-equiv="Content-Language" content="ru">
<meta http-equiv="Content-Type" content="text/html; charset=windows-1251">
<meta http-equiv="Content-Script-Type" content="text/javascript">
<title>Intellisense</title>
<meta name="keywords" content="Intellisense скрипты OpenConf 1С:Предприятие">
<meta name="description" content="Скрипты Intellisense для платформы OpenConf">
<style type="text/css">
	.paragraph {text-align:justify; text-indent:2em; margin-top:0; margin-bottom:0}
</style>
</head>
<body bgcolor=#E0E0E0>

<p><a href="index.html">Перейти на главную страничку сайта (список статей, файлы для скачивания)</a></p>
<p><a href="http://forum.script-coding.com">ФОРУМ (здесь можно обсудить эту статью, а также любые
проблемы программирования на различных макроязыках и в скриптовых средах)</a></p>

<h1>Скрипты Intellisense для платформы OpenConf</h1>

<h2 style="text-indent:1.3em">Назначение и установка</h2>

<p class="paragraph">
Скрипты Intellisense для платформы OpenConf предназначены для расширения функционала плагина "Телепат" и реализации
технологии Intellisense в среде 1С:Предприятие v7.7 в полной мере. Эти скрипты требуют предварительной установки
OpenConf и плагина Телепат. Получить информацию об этих программных продуктах (в том числе и о том, где их можно
скачать вместе со скриптами, о которых идёт речь в этой статье) вы можете в статьях
"<a href="OpenConf.html">Проект OpenConf (Открытый Конфигуратор)</a>" и "<a href="Telepat.html">Плагин Телепат для
платформы OpenConf</a>" на этом сайте. Скрипты Intellisense для платформы OpenConf распространяются свободно.
</p>

<p class="paragraph">
В создании скриптов Intellisense принимали участие:
</p>

<UL style="text-indent:0em; margin-top:5; margin-bottom:5;">
<LI>Аюханов Артур.</LI>
<LI>Диркс Алексей.</LI>
<LI>Кунташов Александр.</LI>
<LI>Реутов Дмитрий.</LI>
<LI>Трошин Дмитрий.</LI>
</UL>

<p class="paragraph">
Установка скриптов Intellisense для платформы OpenConf сводится к следующему:
</p>

<OL style="text-indent:0em; margin-top:5; margin-bottom:5;">

<LI>Установите OpenConf и плагин Телепат, если они ещё не установлены.</LI>

<LI>Скопируйте файлы
<UL style="text-indent:0em; margin-top:5; margin-bottom:5;">
<LI>Collections.wsc</LI>
<LI>CommonServices.wsc</LI>
<LI>SyntaxAnalysis.wsc</LI>
<LI>Registry.wsc</LI>
<LI>OpenConf.RegistryIniFile.wsc</LI>
<LI>scriptlet.tlb</LI>
<LI>SelectValue.dll</LI>
<LI>SelectDialog.dll</LI>
<LI>svcsvc.dll</LI>
</UL>
в любой каталог на жёстком диске, например
<br><br>
<span style="color:navy; font-weight:bold;">
C:\Program Files\1Cv77\BIN\config\system\
</span>
<br><br>
Эти файлы не должны лежать непосредственно в подкаталоге "config" каталога исполняемых файлов 1С:Предприятия, так
как все dll-файлы из этой папки OpenConf считает плагинами и пытается их загрузить в момент запуска Конфигуратора
(а эти файлы плагинами для OpenConf не являются). Зарегистрируйте в системе каждую из вышеуказанных библиотек (кроме
.tlb) с помощью <b>regsvr32.exe</b>, если это ещё не сделано. Командная строка регистрации библиотеки может
выглядеть, например, так:
<br><br>
<span style="color:navy; font-weight:bold;">
regsvr32.exe "C:\Program Files\1Cv77\BIN\config\system\Collections.wsc"
</span>
<br><br>
Важное замечание: библиотеку <b>OpenConf.RegistryIniFile.wsc</b> надо регистрировать в тот момент, когда библиотека
<b>Registry.wsc</b> уже зарегистрирована, иначе при регистрации возникнет ошибка.</LI>

<LI>Скопируйте папку <b>Intell</b> со всем содержимым в подкаталог "config" каталога исполняемых файлов
1С:Предприятия, если этой папки там ещё нет. Полный путь к уже скопированной папке может выглядеть, например, так:
<br><br>
<span style="color:navy; font-weight:bold;">
C:\Program Files\1Cv77\BIN\config\Intell\
</span>
<br><br>
</LI>

<LI>Скопируйте файлы
<UL style="text-indent:0em; margin-top:5; margin-bottom:5;">
<LI>Intellisence.vbs</LI>
<LI>dots.vbs</LI>
<LI>RunAllIntellisence.vbs</LI>
<LI>VimComplete.js</LI>
</UL>
в подкаталог "config\scripts\Intellisense\" каталога исполняемых файлов 1С:Предприятия, если этих файлов там ещё
нет. Полный путь к этому каталогу может выглядеть, например, так:
<br><br>
<span style="color:navy; font-weight:bold;">
C:\Program Files\1Cv77\BIN\config\scripts\Intellisense\
</span>
<br><br>
Примечание: в принципе, папку "Intellisense" можно и не создавать, положив скрипты прямо в "config\scripts\".
Однако, кроме скриптов группы Intellisense, для OpenConf существуют и другие скрипты. Если впоследствии вы захотите
установить их, хорошо организованная структура папок вам пригодится.
</LI>

<LI>Перезапустите Конфигуратор, если он был запущен.</LI>

<LI>С помощью меню "OpenConf" - "Макросы" - "Клавиатура..." назначьте быстрые клавиши следующим макросам:
<UL style="text-indent:0em; margin-top:5; margin-bottom:5;">
<LI>MethodsList (Intellisence.vbs) - например, Ctrl+I.</LI>
<LI>SelectAndPasteTypeFromPossibleTypes (Intellisence.vbs).</LI>
<LI>AddTypeDefinition (Intellisence.vbs).</LI>
<LI>NextWord (VimComplete.js) - например, Ctrl+N.</LI>
<LI>PrevWord (VimComplete.js) - например, Ctrl+P.</LI>
</UL>
</LI>

</OL>

<h2 style="text-indent:1.3em">Использование</h2>

<p class="paragraph">
После установки скриптов Intellisense при наборе кода вы будете получать список автозаполнения в гораздо большем
количестве случаев, чем это может предложить бета-версия Телепата (например, вы будете получать список свойств и
методов объекта после точки). Перечислять досконально все случаи, когда предлагаются те или иные подсказки, большого
смысла нет, поэтому экспериментируйте - вам обязательно понравится.
</p>

<p class="paragraph">
Скрипты Intellisense содержат макросы (состав макросов вы можете изучить в дереве на вкладке OpenConf окна
конфигурации), каждому из которых вы можете назначить сочетание клавиш через меню "OpenConf" - "Макросы" -
"Клавиатура...". Часть макросов может быть интересна только разработчикам (например, для отладки).
</p>

<p class="paragraph">
Скрипт <b>Intellisence.vbs</b> реализует основной функционал Intellisense.
</p>

<p class="paragraph">
Скрипт <b>dots.vbs</b> позволяет при работе в любом модуле (например, внешняя обработка или модуль документа)
использовать определения из глобального модуля. Например, если в глобальном модуле определена экспортируемая
переменная "глТЗ", которая проинициализирована в процедуре ПриНачалеРаботыСистемы() или в разделе основной программы
глобального модуля как "глТЗ = СоздатьОбъект("ТаблицаЗначений");", в модуле какого-либо документа после конструкции
"глТЗ." будет выдан список методов ТаблицыЗначений. Разумеется, сама переменная "глТЗ" тоже будет выдаваться в
списках автодополнения.
</p>

<p class="paragraph">
Скрипт <b>RunAllIntellisence.vbs</b> необходим для связки dots.vbs и Intellisence.vbs. Сначала вызывается
Intellisence.vbs, и, если он не смог выдать список методов, управление передаётся в dots.vbs.
</p>

<p class="paragraph">
Скрипт <b>VimComplete.js</b> реализует дополнительный функционал автодополнения слов в стиле редактора Vim.
</p>

<p class="paragraph" style="text-align:center">***</p>

<p class="paragraph">
Несколько полезных советов:
</p>

<UL style="text-indent:0em; margin-top:5; margin-bottom:5;">

<LI>Используйте Ctrl+Space в любом месте модуля, чтобы открыть список автозаполнения, если он не открылся
автоматически.</LI>

<LI>Наберите следующий код:
<br><br>
<span style="color:navy; font-weight:bold;">
МояТаблицаЗначений=СоздатьОбъект("ТаблицаЗначений");<br>
МояТаблицаЗначений.НоваяКолонка("Кол1");<br>
МояТаблицаЗначений.НоваяКолонка("Кол2");<br>
МояТаблицаЗначений.|
</span>
<br><br>
(Вертикальной чертой обозначена позиция курсора.) Нажмите Ctrl+Space, чтобы отобразить список автозаполнения, если
он не отобразился автоматически. Попробуйте выбрать "<b>ВыбратьСтроки(); + Цикл по строкам</b>" или
"<b>НоваяСтрока(); + Автозаполнение ТЗ</b>" - вы получите характерные готовые фрагменты кода.
</LI>

<LI>В списке автодополнения есть поле для ввода строки (на нём и стоит курсор при появлении списка). Попробуйте
набрать в этом поле строку "в стр" (через пробел), и вы отфильтруете список по вхождению подстрок "в" и "стр".</LI>

<LI>Вы можете использовать явное задание типов переменных следующими способами:
<br><br>
<span style="color:navy; font-weight:bold;">
<pre>
Перем ТЗ, //:ТаблицаЗначений
СЗ; //:СписокЗначений
Перем Сам; // : Контекст
//тип будет определён из контекста, например, для классов 1С++
//(для получения списка методов и свойств класса после точки)
//"Контекст" можно использовать и для типов функций (см. примеры чуть ниже)
//***********************************************
Процедура ТестПроц (СЗ2, Контр, МД, Таб)
    // СЗ2 //:СписокЗначений
    // Контр //:Справочник.Контрагенты
    // МД //:Метаданные
    // Таб //:Таблица
    ...
КонецПроцедуры
//***********************************************
Процедура ТестПроц (СЗ2, //:СписокЗначений
                    Контр, //:Справочник.Контрагенты
                    МД, //:Метаданные
                    Таб //:Таблица
                    )
    ...
КонецПроцедуры
//***********************************************
Тест = //:ТаблицаЗначений
ПолучитьТЗ();
//***********************************************
Функция ТестФунк (Парам)
    ...
КонецФункции // : ТаблицаЗначений
//***********************************************
Функция ТестФунк() // : ТаблицаЗначений
    ...
КонецФункции
//***********************************************
Функция ТестФунк() // : ТаблицаЗначений
    тз = СоздатьОбъект("ТаблицаЗначений");
    Возврат тз;
КонецФункции
Функция ТестФунк2()
    Возврат ТестФунк();
КонецФункции
табл = ТестФунк2();
табл.|
//здесь после точки будет получен список методов ТаблицыЗначений
</pre>
</span>
После такого явного задания типа переменной или функции вы будете получать после точки список атрибутов и методов объекта. При старте скрипт <i>Intellisence.vbs</i> читает определения переменных в глобальном модуле, разыскивая конструкции вида
<span style="color:navy; font-weight:bold;">
<pre>
Перем &lt;ИмяПеременной&gt; Экспорт; //:&lt;ИмяТипа&gt;
</pre>
</span>
Такие конструкции заносятся в список типизированных глобальных переменных, и при любом обращении к ним вне глобального модуля тип определяется из этого кэша.
</LI>

</UL>

<p class="paragraph">
Макрос <b>SelectAndPasteTypeFromPossibleTypes</b> скрипта Intellisence.vbs служит для быстрой вставки в текст типа
переменной (например, чтобы облегчить ввод комментариев для явного задания типов переменных).
</p>

<p class="paragraph">
Макрос <b>AddTypeDefinition</b> скрипта Intellisence.vbs служит для быстрой вставки в текст конструкции типа
" // : ИмяТипа" (чтобы облегчить ввод комментариев для явного задания типов переменных).
</p>

<p class="paragraph">
Макрос <b>CreateArgsTypeDefs</b> скрипта Intellisence.vbs создает в диалоговом режиме для текущей процедуры или функции строки определения типов для каждого аргумента. Аргументы выбираются из списка аргументов, после выбора аргумента предлагается выбрать его тип из списка возможных типов. Прервать подстановку определений типов можно нажав Escape в списке аргументов или в списке типов. Требует наличия скрипта <i>Переходы по модулю.vbs</i>, см. статью <a href="Navigation.html">Скрипты для платформы OpenConf: навигация по коду</a>.
</p>

<p class="paragraph" style="text-align:center">***</p>

<p class="paragraph">
Макрос <b>CopyLine</b> скрипта Intellisence.vbs копирует строку или часть текущей строки слева от курсора на
следующую строку (это может пригодиться, например, при инициализации многочисленных полей какого-либо объекта).
Чтобы понять, как это работает, установите курсор посередине любой непустой строки модуля и нажмите заданное
сочетание клавиш для макроса несколько раз.
</p>

<p class="paragraph" style="text-align:center">***</p>

<p class="paragraph">
Макрос <b>MethodsList</b> скрипта Intellisence.vbs выводит список атрибутов и методов объекта после точки (в
большинстве случаев это происходит автоматически). Несколько полезных советов:
</p>

<UL style="text-indent:0em; margin-top:5; margin-bottom:5;">
<LI>Установите курсор в начале новой строки в теле модуля. Нажмите заданное сочетание клавиш для макроса, и вы
должны увидеть список автозавершения, который будет состоять только из предопределённых процедур.</LI>
<LI>В конструкциях типа
<br><br>
<span style="color:navy; font-weight:bold;">
СоздатьОбъект("<br>
ПолучитьПустоеЗначение("<br>
Если ТипЗначенияСтр()="<br>
//:
</span>
<br><br>
вызов макроса приведёт к выдаче в списке автодополнения всех возможных объектов. Примечание: последняя конструкция
позволяет облегчить ввод комментариев для явного задания типов переменных (см. выше).
</LI>
</UL>

<p class="paragraph" style="text-align:center">***</p>

<p class="paragraph">
Набор макросов скрипта dots.vbs, описанный в таблице ниже, позволяет работать с так называемым "словарём", который реализует механизм, аналогичный "списку быстрой вставки" или "многокарманному" буферу обмена в некоторых других программах. Словарь - это текстовый файл <i>DictDots.txt</i>, создаваемый автоматически в каталоге BIN установки 1С:Предприятия, который будет содержать список быстрой вставки (при желании этот файл можно отредактировать и вручную). Макросы:
</p>

<br>
<TABLE border="1" width="100%" cellspacing="0">

<TR>
<TD>AddWordToSlovar</TD>
<TD>Добавляет выделенный текст в словарь. Если выделено несколько строк, будет добавлено несколько значений.</TD>
</TR>

<TR>
<TD>AddToSlovarFromClopboard</TD>
<TD>Добавляет в словарь содержимое буфера обмена. Возможна замена текущего содержимого словаря, либо добавление содержимого к существующим данным словаря. Выбор варианта добавления осуществляется в списке. Если в буфере многострочный текст, будет добавлено несколько значений.</TD>
</TR>

<TR>
<TD>InsertFromSlovar</TD>
<TD>Вставляет выбранную строку из словаря в текущую позицию курсора. Выбор осуществляется в списке с фильтрацией (возможна фильтрация по нескольким подстрокам).</TD>
</TR>

<TR>
<TD>SelectStringFromClipboard</TD>
<TD>Позволяет выполнить подстановку в текущую позицию курсора одной из строк многострочного текста, находящегося в буфере обмена. Выбор осуществляется в списке с фильтрацией (возможна фильтрация по нескольким подстрокам). Рекомендуется вешать на хоткей Ctrl+D. Макрос не работет со словарём, но описан здесь, т.к. реализует сходный функционал.</TD>
</TR>

</TABLE>
<br>

<p class="paragraph" style="text-align:center">***</p>

<p class="paragraph">
Макросы <b>NextWord</b> и <b>PrevWord</b> скрипта VimComplete.js осуществляют автодополнение слов в стиле редактора
Vim. Макрос NextWord берёт незавершённое слово, находящееся слева от курсора, и пытается дополнить его, ища вперед
по тексту слова с такой же левой частью. Подставляет первое подходящее. Следующий вызов макроса подставит следующее
за первым найденным словом и так далее (при достижении последней строки модуля поиск продолжится с первой строки).
Макрос PrevWord делает то же, только поиск слов осуществляется в обратном направлении. Если вы случайно проскочили
подходящее слово, пользуясь макросом NextWord, вызывайте макрос PrevWord, чтобы вернуться назад на сколько надо
шагов. Номер шага вы можете видеть в строке состояния Конфигуратора.
</p>

<p class="paragraph">
Чтобы понять, как это работает, наберите в модуле следующий текст:
</p>

<br>
<span style="color:navy; font-weight:bold;">
Слово1<br>
Слово2<br>
сл<br>
Слово3<br>
Слово4
</span>
<br><br>

<p class="paragraph">
Установите курсор на конец третьей строки ("сл") и позапускайте несколько раз макросы NextWord и PrevWord, пользуясь
назначенными им сочетаниями клавиш.
</p>

<p class="paragraph" style="text-align:center">***</p>

<p class="paragraph">
Осуществляется поддержка классов 1С++. Если Вы собираетесь работать с классами 1С++ (кроме случая использования
встроенных классов), то необходимо в папке <b>C:\Program Files\1Cv77\BIN\config\Intell\1С++\</b> создать для каждого
класса файл <b>&lt;ИмяКласса&gt;.ints</b> с перечислением методов и атрибутов класса. Формат можно посмотреть в
файлах .ints стандартных классов.
</p>

<p class="paragraph">
Вместо ручной компоновки ints-файлов можно запустить на исполнение макрос Update1CppInts скрипта Intellisence.vbs
(это можно сделать двойным щелчком по имени макроса в дереве на вкладке "OpenConf" окна конфигурации). Все классы
1С++ представляют собой текстовые файлы или (намного чаще) внешние обработки (ert-файлы). Все классы 1С++ должны
быть описаны в файле defcls.prm в каталоге Информационной базы 1С:Предприятия. В этом файле описана связь имени
класса с файлом или внешней обработкой. Вышеуказанный макрос анализирует файл defcls.prm, находит все классы,
просматривает их код и составляет список методов в виде ints-файлов. Например, если есть класс
"Общие.ТаблицаЗначений", после запуска макроса в каталоге \config\Intell\1С++\ появится файл
"Общие.ТаблицаЗначений.ints". Впоследствии запуск макроса нужно выполнять всякий раз, когда добавляется новый класс
или изменяется один из существующих.
</p>

<p class="paragraph">
Когда ints-файлы для классов 1С++ сформированы, вы можете проверить работу Intellisense. Например, если есть класс
"Общие.ТаблицаЗначений", наберите в модуле следующий код:
</p>

<br>
<span style="color:navy; font-weight:bold;">
ТЗ = СоздатьОбъект("Общие.ТаблицаЗначений");<br>
ТЗ.
</span>
<br><br>

<p class="paragraph">
Поле набора последней точки вы должны увидеть список автодополнения с методами и атрибутами класса.
</p>

<h2 style="text-indent:1.3em">Тонкая настройка</h2>

<p class="paragraph">
Вы можете дополнять списки Intellisense редактированием файлов в каталоге
<b>C:\Program Files\1Cv77\BIN\config\Intell\</b>. Например, откройте файл "СоздатьОбъект.ints" и добавьте в конец
строку "0000 Scripting.Dictionary". Затем создайте файл "Scripting.Dictionary.ints" и добавьте в него строки "0000
Count" и "0000 Add(f)". Перезагрузите скрипт "Intellisence.vbs" на вкладке "OpenConf" окна конфигурации (это можно
сделать с помощью соответствующей команды контекстного меню на элементе скрипта в дереве). Теперь при создании в
коде объекта "Scripting.Dictionary" (с помощью функции "СоздатьОбъект") вы будете иметь после точки в списке
автодополнения свойство "Count" и метод "Add".
</p>

<p class="paragraph">
Настройка работы скрипта "Intellisence.vbs" производится в файле
<b>C:\Program Files\1Cv77\BIN\config\Intell\Intell.ini</b>. Все параметры этого файла подробно закомментированы в
нём самом. После исправления Intell.ini перезагрузите скрипт "Intellisence.vbs" на вкладке "OpenConf" окна
конфигурации (это можно сделать с помощью соответствующей команды контекстного меню на элементе скрипта в дереве).
Примечание: не рекомендуется устанавливать параметр CHOICELIST_KIND = 1, т.к. замечено, что в этом случае при
использовании списков автодополнения Intellisense Конфигуратор иногда на некоторое время теряет фокус (зависает).
</p>

<h2 style="text-indent:1.3em">Генератор ints-файлов (списков Intellisense)</h2>

<p class="paragraph">
Генератор ints-файлов позволит получать подсказки Intellisense (при работе в редакторе кода 1С:Предприятия) для
любого COM-сервера, зарегистрированного в системе. Чтобы установить генератор ints-файлов, проделайте следующее:
</p>

<UL style="text-indent:0em; margin-top:5; margin-bottom:5;">
<LI>Скопируйте файл TLBINF32.DLL в любой каталог на жёстком диске, например
<br><br>
<span style="color:navy; font-weight:bold;">
C:\Program Files\1Cv77\BIN\config\system\
</span>
<br><br>
Этот файл не должен лежать непосредственно в подкаталоге "config" каталога исполняемых файлов 1С:Предприятия.
Зарегистрируйте в системе эту библиотеку с помощью regsvr32.exe. Командная строка регистрации библиотеки может
выглядеть, например, так:
<br><br>
<span style="color:navy; font-weight:bold;">
regsvr32.exe "C:\Program Files\1Cv77\BIN\config\system\TLBINF32.DLL"
</span>
<br><br>
</LI>
<LI>Скопируйте файл intsOLEGenerator.vbs в подкаталог "config\scripts\" каталога исполняемых файлов 1С:Предприятия.
Полный путь к этому каталогу может выглядеть, например, так:
<br><br>
<span style="color:navy; font-weight:bold;">
C:\Program Files\1Cv77\BIN\config\scripts\Intellisense\
</span>
<br><br>
</LI>
<LI>Перезапустите Конфигуратор, если он был запущен.</LI>
</UL>

<p class="paragraph">
Макрос <b>Generator</b> скрипта intsOLEGenerator.vbs позволяет сгенерировать ints-файлы списков Intellisense для
указанного COM-сервера. Запустите макрос с помощью клавиш Ctrl+M и укажите ProgID нужного COM-сервера
(например, "Excel.Application"). В каталоге C:\Program Files\1Cv77\BIN\config\Intell\ будут созданы необходимые
файлы (это может занять некоторое время). После этого будет выдан запрос на создание ALS-файла. Если вы ответите
утвердительно, ALS-файл будет создан в каталоге C:\Program Files\1Cv77\BIN\ (это также может занять некоторое
время). Далее, чтобы увидеть этот ALS-файл в дереве синтакс-помощника, перезапустите Конфигуратор или воспользуйтесь
командой "Обновить" контекстного меню синтакс-помощника. Количество полезной информации в таком ALS-файле будет
зависеть от содержимого библиотеки самого COM-сервера и может оказаться невелико.
</p>

<p class="paragraph">
Если вы успешно сгенерировали ints-файлы для COM-сервера "Excel.Application", то после набора следующего кода:
<br><br>
<span style="color:navy; font-weight:bold;">
ExcelApp=СоздатьОбъект("Excel.Application");<br>
ExcelApp.|
</span>
<br><br>
вы должны увидеть подсказку Intellisense, т.е. список свойств и методов (вертикальной чертой обозначена позиция
курсора ввода).
</p>

<p class="paragraph">
Макрос <b>ReGenerator</b> скрипта intsOLEGenerator.vbs позволяет запустить генерацию ints-файлов для указанного
COM-сервера повторно, например, если захотелось сгенерировать ALS-файл, который не был сгенерирован ранее, или если
при запуске макроса Generator произошла ошибка (например, библиотека COM-сервера была не найдена или не
зарегистрирована).
</p>

<p style="text-align:right">
<small>Людоговский Александр</small>
</p>

<p><a href="index.html">Перейти на главную страничку сайта (список статей, файлы для скачивания)</a></p>

<p><small>&copy; 2007 <A HREF='http://www.script-coding.com/'>http://www.script-coding.com</A> При любом использовании материалов сайта обязательна <b>ссылка</b> на него как на источник информации, а также сохранение <b>целостности</b> и <b>авторства</b> материалов.</small>



</body></html>