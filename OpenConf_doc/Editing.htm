<html><head>
<meta http-equiv="Content-Language" content="ru">
<meta http-equiv="Content-Type" content="text/html; charset=windows-1251">
<meta http-equiv="Content-Script-Type" content="text/javascript">
<title>Editing</title>
<meta name="keywords" content="Editing скрипты OpenConf 1С:Предприятие">
<meta name="description" content="Скрипты для платформы OpenConf: редактирование кода">
<style type="text/css">
	.paragraph {text-align:justify; text-indent:2em; margin-top:0; margin-bottom:0}
</style>
</head>
<body bgcolor=#E0E0E0>

<p><a href="index.html">Перейти на главную страничку сайта (список статей, файлы для скачивания)</a></p>
<p><a href="http://forum.script-coding.com">ФОРУМ (здесь можно обсудить эту статью, а также любые
проблемы программирования на различных макроязыках и в скриптовых средах)</a></p>

<h1>Скрипты для платформы OpenConf: редактирование кода</h1>

<h2 style="text-indent:1.3em">Назначение и установка скриптов</h2>

<p class="paragraph">
Скрипты для платформы OpenConf, о которых пойдёт речь в этой статье, предназначены для повышения удобства и
автоматизации редактирования кода конфигурации или внешних обработок 1С:Предприятия. Данные скрипты требуют наличия
работающего OpenConf. Получить информацию об OpenConf (в том числе и о том, где его можно скачать вместе со
скриптами, о которых пойдёт речь в этой статье) вы можете в статье "<a href="OpenConf.html">Проект OpenConf
(Открытый Конфигуратор)</a>" на этом сайте. Скрипты для платформы OpenConf распространяются свободно.
</p>

<p class="paragraph">
Установка скриптов сводится к следующему:
</p>

<OL style="text-indent:0em; margin-top:5; margin-bottom:5;">

<LI>Установите OpenConf, если он ещё не установлен.</LI>

<LI>Скопируйте файлы
<UL style="text-indent:0em; margin-top:5; margin-bottom:5;">
<LI>CommonServices.wsc</LI>
<LI>Registry.wsc</LI>
<LI>svcsvc.dll</LI>
<LI>WshExtra.dll</LI>
</UL>
в любой каталог на жёстком диске, например
<br><br>
<span style="color:navy; font-weight:bold;">
C:\Program Files\1Cv77\BIN\config\system\
</span>
<br><br>
Эти файлы не должны лежать непосредственно в подкаталоге "config" каталога исполняемых файлов 1С:Предприятия, так
как все dll-файлы из этой папки OpenConf считает плагинами и пытается их загрузить в момент запуска Конфигуратора
(а эти файлы плагинами для OpenConf не являются). Зарегистрируйте в системе каждую из вышеуказанных библиотек с
помощью regsvr32.exe, если это ещё не сделано. Командная строка регистрации библиотеки может выглядеть, например,
так:
<br><br>
<span style="color:navy; font-weight:bold;">
regsvr32.exe "C:\Program Files\1Cv77\BIN\config\system\CommonServices.wsc"
</span>
<br><br>
</LI>

<LI>Скопируйте файлы
<UL style="text-indent:0em; margin-top:5; margin-bottom:5;">
<LI>author.js</LI>
<LI>Brackets.vbs</LI>
<LI>bufer.vbs</LI>
<LI>RTrimModule.vbs</LI>
<LI>Замена кода trad.vbs</LI>
<LI>Замена кода.vbs</LI>
<LI>Копировать модуль в буфер обмена.vbs</LI>
<LI>Форматирование текста.vbs</LI>
<LI>code_beautifier.pl - только если вы будете устанавливать ActivePerl (см. ниже)</LI>
<LI>CodeIns.pl - только если вы будете устанавливать ActivePerl (см. ниже)</LI>
<LI>RunPerlScripts.vbs - только если вы будете устанавливать ActivePerl (см. ниже)</LI>
</UL>
в подкаталог "config\scripts\Editing\" каталога исполняемых файлов 1С:Предприятия, если этих файлов там ещё нет.
Полный путь к этому каталогу может выглядеть, например, так:
<br><br>
<span style="color:navy; font-weight:bold;">
C:\Program Files\1Cv77\BIN\config\scripts\Editing\
</span>
<br><br>
Примечание: в принципе, папку "Editing" можно и не создавать, положив скрипты прямо в "config\scripts\". Однако,
кроме этих скриптов, для OpenConf существуют и другие скрипты. Если впоследствии вы захотите установить их, хорошо
организованная структура папок вам пригодится.
</LI>

<LI>Установка скриптов ActivePerl (по желанию):
<UL style="text-indent:0em; margin-top:5; margin-bottom:5;">
<LI>Если ActivePerl не установлен на вашем компьютере, скачайте <a href="http://www.activestate.com/ActivePerl">
дистрибутив ActivePerl</a> и установите его (ActivePerl распространяется свободно).
</LI>
<LI>Скопируйте файл <b>CodeWorks.pm</b> в подкаталог <b>lib</b> каталога установки ActivePerl.</LI>
<LI>Скопируйте файлы <b>ФормаДокумента.pl</b> и <b>ФормаЭлемента.pl</b> в каталог той информационной базы, в которой
вы хотите испробовать скрипты ActivePerl.</LI>
</UL>
</LI>

<LI>Перезапустите Конфигуратор, если он был запущен.</LI>

</OL>

<h2 style="text-indent:1.3em">Использование</h2>

<p class="paragraph">
Установленные скрипты содержат макросы (состав макросов вы можете изучить в дереве на вкладке OpenConf окна
конфигурации), каждому из которых вы можете назначить сочетание клавиш через меню "OpenConf" - "Макросы" -
"Клавиатура...". Перед установкой сочетаний клавиш вы можете запустить любой макрос вручную, находясь в любом режиме
работы, нажав Ctrl+M и выбрав нужный макрос в специальном диалоговом окне.
</p>

<p class="paragraph">
Скрипт <b>author.js</b> автоматизирует разметку кода по признакам модифицированности со вставкой авторского
комментария (подписи автора). Гибкая настройка подписи производится в специальном диалоговом окне. Полезные макросы:
</p>

<br>
<TABLE border="1" width="100%" cellspacing="0">
<TR><TH>Макрос</TH><TH>Описание</TH></TR>

<TR>
<TD>Настройка</TD>
<TD>Вызывает окно настроек подписи. Настройки сохраняются в реестре в папке
<b>HKEY_CURRENT_USER\Software\1C\1Cv7\7.7\OpenConf\Scripts\Авторские комментарии\</b>.</TD>
</TR>

<TR>
<TD>МаркерДобавлен</TD>
<TD>Маркирует выделенный блок или текущую строку признаком "Добавлен".</TD>
</TR>

<TR>
<TD>МаркерИзменен</TD>
<TD>Копирует и маркирует выделенный блок или текущую строку признаком "Изменён".</TD>
</TR>

<TR>
<TD>МаркерУдален</TD>
<TD>Комментирует и маркирует выделенный блок или текущую строку признаком "Удалён".</TD>
</TR>

<TR>
<TD>ВставитьТекст</TD>
<TD>Вставляет текст из буфера обмена и маркирует его как добавленный. Если выделен блок текста, этот блок
комментируется и маркируется как изменённый (изменённый на текст из буфера обмена).</TD>
</TR>

</TABLE>
<br>

<p class="paragraph">
Чтобы понять, как работают макросы подписей, поэксперементируйте с настройками (макрос "Настройка"). Потраченное
время с лихвой окупится удобством редактирования кода "чужих" (например, типовых) конфигураций, когда будет
необходимо помечать в коде сделанные изменения. Макросы работают немного по-разному в ситуациях, когда выделено
несколько строк, или одна строка (или ничего не выделено).
</p>

<p class="paragraph">
Скрипт <b>Brackets.vbs</b> позволяет обрамить текст в коде выбранной конструкцией, например двойными кавычками,
конструкцией "СокрЛП(...)" и подобными. Если текст состоит из нескольких слов, его необходимо выделить. Полезные
макросы:
</p>

<br>
<TABLE border="1" width="100%" cellspacing="0">
<TR><TH>Макрос</TH><TH>Описание</TH></TR>

<TR>
<TD>ChoiseTypeBracket</TD>
<TD>Выдаёт список возможных конструкций для выбора и обрамляет текст выбранной конструкцией. Точка в каждой
предлагаемой конструкции определяет положение обрамляемого текста.</TD>
</TR>

<TR>
<TD>AddBracket</TD>
<TD>Обрамляет текст последней выбранной конструкцией без вопросов.</TD>
</TR>

</TABLE>
<br>

<p class="paragraph">
Список предлагаемых конструкций при необходимости можно отредактировать, открыв скрипт в любом текстовом редакторе.
Для этого в процедуре скрипта ChoiseTypeBracket() следует отредактировать оператор присвоения значения переменной
ArrOfTypeBracket, например, добавив в массив свои конструкции. Точка в каждой конструкции определяет положение
обрамляемого текста.
</p>

<p class="paragraph">
Скрипт <b>bufer.vbs</b> позволяет эмулировать "многокарманный" буфер обмена (как в MS Office XP/2003 или Punto
Switcher), сменить регистр текста (как в MS Word), автоматически сменить раскладку (рус/лат) неверно набранного
текста (как в Punto Switcher). Полезные макросы:
</p>

<br>
<TABLE border="1" width="100%" cellspacing="0">
<TR><TH>Макрос</TH><TH>Описание</TH></TR>

<TR>
<TD>Settings</TD>
<TD>Настройка многокарманного буфера в диалоговом окне. Позволяет включить/выключить многокарманный буфер и
включить/выключить использование меток в многокарманном буфере. Если поставить флажок "Использовать метки", то при
копировании текста будет выдаваться запрос на задание метки к копируемому тексту. Впоследствии при выборе из
многокарманного буфера будут показываться метки, а не сам текст.</TD>
</TR>

<TR>
<TD>CopyText</TD>
<TD>Копирует текст в многокарманный буфер. Если окно не текстовое, то копирование осуществляется стандартным
буфером. Можно назначить сочетание клавиш Ctrl+C.</TD>
</TR>

<TR>
<TD>PasteText</TD>
<TD>Осуществляет вставку текста. Если окно не текстовое, то вставка происходит из стандартного буфера. Можно
назначить сочетание клавиш Ctrl+V.</TD>
</TR>

<TR>
<TD>EmptyBufer</TD>
<TD>Удаляет из буфера выбранное значение. Можно назначить сочетание клавиш Ctrl+Shift+D.</TD>
</TR>

<TR>
<TD>EmptyAll</TD>
<TD>Удаляет из буфера всё содержимое. Можно назначить сочетание клавиш Ctrl+D.</TD>
</TR>

<TR>
<TD>Translit</TD>
<TD>Сменить раскладку (рус/лат) выделенного текста.</TD>
</TR>

<TR>
<TD>ToggleCase</TD>
<TD>Сменить регистр текущего слова или выделенного текста. Можно назначить сочетание клавиш Shift+F3. Смена регистра
имеет три итерации: все строчные, все заглавные, первая заглавная.</TD>
</TR>

</TABLE>
<br>

<p class="paragraph">
Скрипт <b>RTrimModule.vbs</b> служит для удаления пустых строк и пробелов в концах строк программных модулей.
Полезные макросы:
</p>

<br>
<TABLE border="1" width="100%" cellspacing="0">
<TR><TH>Макрос</TH><TH>Описание</TH></TR>

<TR>
<TD>RTrimCurrentWnd</TD>
<TD>Обработка текущего открытого модуля.</TD>
</TR>

<TR>
<TD>ReFormatCurrentWnd</TD>
<TD>Обработка текущего открытого модуля с последующим автоматическим форматированием ("штатным" Ctrl+Shift+F).</TD>
</TR>

<TR>
<TD>RTrimGlobalModuleDocReportsAndCalcVars</TD>
<TD>Обработка глобального модуля, всех документов, отчётов и обработок конфигурации.</TD>
</TR>

</TABLE>
<br>

<p class="paragraph">
Скрипт <b>Замена кода trad.vbs</b> служит для автоматического добавления/убирания в начале выделенного блока
символов: "|" и "//#" и автоматического сдвига влево/вправо текста выделенного блока за символом "|" для
форматирования запросов. Полезные макросы:
</p>

<br>
<TABLE border="1" width="100%" cellspacing="0">
<TR><TH>Макрос</TH><TH>Описание</TH></TR>

<TR>
<TD>FormatSharp</TD>
<TD>Комментирует выделенный блок или текущую строку символами "//#". Можно назначить сочетание клавиш Ctrl+3.
Примечание: при использовании внешней компоненты 1С++ комментарии типа "//#" указывают на команды
препроцессора.</TD>
</TR>

<TR>
<TD>UnFormatSharp</TD>
<TD>Раскомментирует выделенный блок или текущую строку, закомментированную символами "//#". Можно назначить
сочетание клавиш Ctrl+Shift+3.</TD>
</TR>

<TR>
<TD>FormatVertical</TD>
<TD>"Комментирует" выделенный блок или текущую строку символами "|". Можно назначить сочетание клавиш Ctrl+\.</TD>
</TR>

<TR>
<TD>UnFormatVertical</TD>
<TD>"Раскомментирует" выделенный блок или текущую строку, "закомментированную" символами "|". Можно назначить
сочетание клавиш Ctrl+Shift+\.</TD>
</TR>

<TR>
<TD>MoveBlockLeftSpace</TD>
<TD>Сдвигает выделенный блок или текущую строку, "закомментированную" символами "|", на пробел влево (если это
возможно). Можно назначить сочетание клавиш Ctrl+[.</TD>
</TR>

<TR>
<TD>MoveBlockRightSpace</TD>
<TD>Сдвигает выделенный блок или текущую строку, "закомментированную" символами "|", на пробел вправо. Можно
назначить сочетание клавиш Ctrl+].</TD>
</TR>

<TR>
<TD>MoveBlockLeftTab</TD>
<TD>Сдвигает выделенный блок или текущую строку, "закомментированную" символами "|", на табулятор влево (если это
возможно). Можно назначить сочетание клавиш Ctrl+,.</TD>
</TR>

<TR>
<TD>MoveBlockRightTab</TD>
<TD>Сдвигает выделенный блок или текущую строку, "закомментированную" символами "|", на табулятор вправо. Можно
назначить сочетание клавиш Ctrl+..</TD>
</TR>

</TABLE>
<br>

<p class="paragraph">
Скрипт <b>Замена кода.vbs</b> служит для замены и/или обрамления кода различными способами, удобного копирования
строк, вставки комментариев и т.п. (см. ниже описание макросов). Полезные макросы:
</p>

<br>
<TABLE border="1" width="100%" cellspacing="0">
<TR><TH>Макрос</TH><TH>Описание</TH></TR>

<TR>
<TD>CodeReplace</TD>
<TD>Служит для замены выделенного блока или текущей строки кода с включением обрамляющих комментариев (похоже на
макрос "МаркерИзменен" из author.js, но немного в другом стиле). Чтобы настроить начальный и конечный комментарий,
присвойте нужные значения переменным sBeginComment и sEndComment в начале скрипта.</TD>
</TR>

<TR>
<TD>CodeReplaceWithQuestion</TD>
<TD>То же, что и CodeReplace, но текст начального и конечного комментария каждый раз запрашивается в диалоговом
окне.</TD>
</TR>

<TR>
<TD>CodeFramingWithQuestion</TD>
<TD>Служит для обрамления выделенного блока или текущей строки кода указанными комментариями. Текст начального и
конечного комментария каждый раз запрашивается в диалоговом окне.</TD>
</TR>

<TR>
<TD>CodeFramingForTimer</TD>
<TD>Служит для обрамления выделенного блока или текущей строки кода командами "гТаймер.Запуск("Method");" и
"гТаймер.Стоп("Method");", где "Method" - имя метода, которое запрашивается в диалоговом окне при вызове
макроса. Примечание: удобно при использовании класса "Общие.ТаймерСКоличеством" 1С++ для профилирования кода, т.е.
определения наиболее "медленных" участков кода. Класс доступен для скачивания
<a href="http://1c.proclub.ru/modules/mydownloads/personal.php?lid=2566&cid=116">здесь</a>.</TD>
</TR>

<TR>
<TD>CopyLine</TD>
<TD>Копирует текущую строку или выделенный блок кода. Если назначить этому макросу "быструю" клавишу, такое
копирование становится значительно более удобным, чем копирование "штатными" способами.</TD>
</TR>

<TR>
<TD>ExchangeLeftAndRightOfAssign</TD>
<TD>Меняет местами левую и правую часть оператора присваивания с сохранением возможных комментариев и пробелов возле
знака "=".</TD>
</TR>

<TR>
<TD>CommentSelection<br>UnCommentSelection</TD>
<TD>Комментируют и раскомментируют выделенный блок или текущую строку. В отличие от типовых "Ctrl+/" и
"Ctrl+Shift+/" не требуют выделения, если работа происходит с текущей строкой. В vbs-скриптах при работе с текущей
строкой используют символ апострофа.</TD>
</TR>

</TABLE>
<br>

<p class="paragraph">
Скрипт <b>Копировать модуль в буфер обмена.vbs</b> позволяет скопировать текст текущего модуля в буфер обмена или
заменить текст текущего модуля на содержимое буфера обмена, не затронув конструкцию "#ЗагрузитьИзФайла", если
таковая имеется в начале модуля. Полезные макросы:
</p>

<br>
<TABLE border="1" width="100%" cellspacing="0">
<TR><TH>Макрос</TH><TH>Описание</TH></TR>

<TR>
<TD>CopyTextToClipboard</TD>
<TD>Копирует текст текущего модуля в буфер обмена.</TD>
</TR>

<TR>
<TD>ReplaceTextFromClipBoard</TD>
<TD>Заменяет текущий модуль на содержимое буфера обмена.</TD>
</TR>

</TABLE>
<br>

<p class="paragraph">
Скрипт <b>Форматирование текста.vbs</b> позволяет выровнять выделенный текст по знакам равенства ("=") различными
способами. Полезные макросы:
</p>

<br>
<TABLE border="1" width="100%" cellspacing="0">
<TR><TH>Макрос</TH><TH>Описание</TH></TR>

<TR>
<TD>FormatBlock</TD>
<TD>Форматирует выделенный блок. Например, текст
<span style="color:navy; font-weight:bold;">
<pre>
ы=1;
абвгде = 2;
</pre>
</span>
превратится в текст
<span style="color:navy; font-weight:bold;">
<pre>
ы      =1;
абвгде = 2;
</pre>
</span>
</TD>
</TR>

<TR>
<TD>FormatLines</TD>
<TD>Форматирует выделенный блок. Например, текст
<span style="color:navy; font-weight:bold;">
<pre>
ы      =1;
абвгде = 2;
</pre>
</span>
превратится в текст
<span style="color:navy; font-weight:bold;">
<pre>
ы      = 1;
абвгде = 2;
</pre>
</span>
</TD>
</TR>

<TR>
<TD>FormatBlockWithTabs</TD>
<TD>То же, что и FormatBlock, но используются символы табуляции.</TD>
</TR>

<TR>
<TD>ChoiseCharForFormating</TD>
<TD>Позволяет сменить символ разделителя (по умолчанию "=") на другой (предлагается список). Выбранный символ будет работать до перезагрузки скрипта (или до следующего перевыбора этого символа).</TD>
</TR>

<TR>
<TD>FormatBlockWithTabsAskChar</TD>
<TD>Запрашивает символ-разделитель (предлагается список), а затем форматирует выделенный блок с использованием символов табуляции. Практически - последовательно вызывает макросы ChoiseCharForFormating и FormatBlockWithTabs.</TD>
</TR>

</TABLE>
<br>

<p class="paragraph">
Скрипт <b>RunPerlScripts.vbs</b> позволяет убрать из текстов модулей лишние пробелы и пустые строки, а также
автоматически сгенерировать текст модуля какого-либо объекта конфигурации на основе существующих шаблонов (такие
шаблоны необходимо предварительно создать). Полезные макросы:
</p>

<br>
<TABLE border="1" width="100%" cellspacing="0">
<TR><TH>Макрос</TH><TH>Описание</TH></TR>

<TR>
<TD>CodeBeautifier</TD>
<TD>Удаляет пробелы в концах строк текущего модуля и пустые строки (из нескольких пустых строк, идущих подряд,
остаётся только одна).</TD>
</TR>

<TR>
<TD>CodeIns</TD>
<TD>Вставляет код в текущий модуль, используя существующие шаблоны в каталоге текущей информационной базы. Файлы 
"ФормаДокумента.pl" и "ФормаЭлемента.pl"  являются примерами таких шаблонов. Удобен при создании нового документа,
справочника, журнала, отчета или обработки в конфигурации. Шаблоны для различных модулей конфигурации необходимо
создать самостоятельно. Возможные имена шаблонов: "МодульДокумента", "ФормаДокумента", "ФормаЭлемента",
"ФормаГруппы", "ФормаСписка", "ФормаЖурнала", "Отчет", "Обработка" (расширение имён файлов - .pl).</TD>
</TR>

<TR>
<TD>CodeInsReferences</TD>
<TD>Применяет шаблоны ко всем справочникам конфигурации.</TD>
</TR>

<TR>
<TD>CodeInsDocuments</TD>
<TD>Применяет шаблоны ко всем документам конфигурации.</TD>
</TR>

<TR>
<TD>CodeInsToAll</TD>
<TD>Последовательно запускает макросы CodeInsReferences и CodeInsDocuments.</TD>
</TR>

</TABLE>
<br>

<p style="text-align:right">
<small>Людоговский Александр</small>
</p>

<p><a href="index.html">Перейти на главную страничку сайта (список статей, файлы для скачивания)</a></p>

<p><small>&copy; 2007 <A HREF='http://www.script-coding.com/'>http://www.script-coding.com</A> При любом использовании материалов сайта обязательна <b>ссылка</b> на него как на источник информации, а также сохранение <b>целостности</b> и <b>авторства</b> материалов.</small>



</body></html>